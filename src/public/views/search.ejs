<%- include("partials/header") %>
<main id="search-container" class="page-wrapper" aria-label="Search media">
    <h1 class="page-title">Search</h1>
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search media..." aria-label="Search query" autocomplete="off" />
        <button type="button" onclick="searchVideos()">Search</button>
    </div>
    <section id="searchResults" class="results-grid" aria-live="polite" aria-label="Search results"></section>
</main>
<script>
        async function searchVideos() {
            try {
                const query = document.getElementById('searchInput').value;
                if (!query.trim()) {
                    document.getElementById('searchResults').innerHTML = '<p>Please enter a search query.</p>';
                    return;
                }

                const response = await fetch(`/api/search?q=${encodeURIComponent(query)}`);
                const apiResponse = await response.json();

                const resultsContainer = document.getElementById('searchResults');
                resultsContainer.innerHTML = '';

                if (!apiResponse.success || !apiResponse.data || apiResponse.data.length === 0) {
                    resultsContainer.innerHTML = '<p>No results found.</p>';
                    return;
                }

                                apiResponse.data.forEach(video => {
                                    const videoElement = document.createElement('article');
                                    videoElement.classList.add('video-item');
                                    videoElement.innerHTML = `
                                        <div class="video-thumbnail" role="button" tabindex="0" aria-label="Open ${video.name}" onclick="playVideo('${video.url}')" onkeypress="if(event.key==='Enter'){playVideo('${video.url}')}" >
                                            <img src="${video.thumbnail || video.url}" alt="${video.name}">
                                        </div>
                                        <p title="${video.name}">${video.name}</p>
                                        <small>Category: ${video.category}</small>
                                    `;
                                    resultsContainer.appendChild(videoElement);
                                });
            } catch (error) {
                console.error('Search error:', error);
                document.getElementById('searchResults').innerHTML = '<p>Error occurred while searching. Please try again.</p>';
            }
        }

        function playVideo(videoUrl) {
            window.location.href = `/?video=${encodeURIComponent(videoUrl)}`;
        }

        // Allow search on Enter key
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchVideos();
            }
        });
    </script>
<%- include("partials/navbar") %>
<%- include("partials/footer") %>
